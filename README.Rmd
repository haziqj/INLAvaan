---
output: github_document
editor_options: 
  chunk_output_type: console
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
options(cli.dynamic = FALSE, cli.progress_show_after = 2)

library(INLAvaan)
library(lavaan)
library(blavaan)
library(tidyverse)
```

# INLAvaan <a href="https://inlavaan.haziqj.ml"><img src="man/figures/logo.png" align="right" height="139" alt="INLAvaan website" /></a>

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
[![R-CMD-check](https://github.com/haziqj/INLAvaan/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/haziqj/INLAvaan/actions/workflows/R-CMD-check.yaml)
[![Codecov test coverage](https://codecov.io/gh/haziqj/INLAvaan/branch/main/graph/badge.svg)](https://app.codecov.io/gh/haziqj/INLAvaan?branch=main)
[![CRAN_Status_Badge_version_ago](http://www.r-pkg.org/badges/version-ago/INLAvaan)](https://cran.r-project.org/package=INLAvaan)
[![](http://cranlogs.r-pkg.org/badges/grand-total/INLAvaan)](https://cran.r-project.org/package=INLAvaan)
<!-- badges: end -->

> Efficient approximate Bayesian inference for Structural Equation Models.

While Markov Chain Monte Carlo (MCMC) methods remain the gold standard for exact Bayesian inference, they can be prohibitively slow for iterative model development. 
`{INLAvaan}` offers a rapid alternative for <u>**la**</u>tent <u>**va**</u>riable <u>**an**</u>alysis, delivering Bayesian results at (or near) the speed of frequentist estimators.
It achieves this through a custom, ground-up implementation of the [Integrated Nested Laplace Approximation (INLA)](https://www.r-inla.org), engineered specifically for the [lavaan](https://lavaan.ugent.be) modelling framework.

## A familiar interface

`{INLAvaan}` is designed to fit seamlessly into your existing workflow.
If you are familiar with the [(b)lavaan syntax](https://lavaan.ugent.be/tutorial/syntax1.html), you can begin using `{INLAvaan}` immediately.

As a first impression of the package, consider the canonical example of SEM applied to the Industrialisation and Political Democracy data set of Bollen (1989)^[Bollen, K. A. (1989). *Structural equations with latent variables* (pp. xiv, 514). John Wiley & Sons. <https://doi.org/10.1002/9781118619179>]:

```{r}
#| label: inlavaan-poldem
library(INLAvaan)
model <- "
  # Latent variable definitions
     ind60 =~ x1 + x2 + x3
     dem60 =~ y1 + y2 + y3
     dem65 =~ y5 + y6 + y7 + y8

  # Latent regressions
    dem60 ~ ind60
    dem65 ~ ind60 + dem60

  # Residual correlations
    y1 ~~ y5
    y2 ~~ y4 + y6
    y3 ~~ y7
    y4 ~~ y8
    y6 ~~ y8
  
  # Fixed loading
    dem60 =~ 1.5*y4
  
  # Custom priors on latent variances
    ind60 ~~ prior('gamma(1, 1)')*ind60
    dem60 ~~ prior('gamma(2, 1)')*dem60
    dem65 ~~ prior('gamma(1,.5)')*dem65
"
utils::data("PoliticalDemocracy", package = "lavaan")

fit <- asem(model, PoliticalDemocracy)

summary(fit)
```

## Validation against MCMC

Computation speed is valuable only when accuracy is preserved.
Our method yields posterior distributions that are visually and numerically comparable to those obtained via MCMC (e.g., via `{blavaan}`/Stan), but at a fraction of the computational cost.

The figure below illustrates the posterior density overlap for the example above.
The percentages refer to the one minus the [Jensen-Shannon distance](https://en.wikipedia.org/wiki/Jensenâ€“Shannon_divergence), which gives a measure of similarity between two probability distributions.

```{r}
#| label: fig-compare-poldem
#| message: false
#| warning: false
#| results: "hide"
#| fig-height: 4.65
#| fig-width: 8
#| out-width: 100%
#| fig-dpi: 300

# install.packages("blavaan")
library(blavaan)
fit_blav <- bsem(model, PoliticalDemocracy)
res <- INLAvaan:::compare_mcmc(fit_blav, INLAvaan = fit)
print(res$p_compare)
```

## Installation

Install the CRAN version of `{INLAvaan}` using:

```r
install.packages("INLAvaan")
```

Alternatively, install the development version of `{INLAvaan}` from GitHub using:

```r
# install.packages("pak")
pak::pak("haziqj/INLAvaan")
```

*Optionally*^[R-INLA dependency has been removed temporarily from v0.2.0.], you may wish to install [INLA](https://www.r-inla.org).
Following the official instructions given [here](https://www.r-inla.org/download-install), install the package by running this command in R:

```r
install.packages(
  "INLA",
  repos = c(getOption("repos"), 
            INLA = "https://inla.r-inla-download.org/R/stable"), 
  dep = TRUE
)
```

## Citation

To cite package `{INLAvaan}` in publications use:

> Jamil, H (`r format(Sys.time(), "%Y")`). _INLAvaan: Approximate Bayesian Latent Variable Analysis_. R package version `r packageVersion("INLAvaan")`. DOI: [10.32614/CRAN.package.INLAvaan](https://doi.org/10.32614/CRAN.package.INLAvaan)

A BibTeX entry for LaTeX users is:

```bibtex
@Manual{,
    title = {INLAvaan: Approximate Bayesian Latent Variable Analysis},
    author = {Haziq Jamil},
    year = {`r format(Sys.time(), "%Y")`},
    note = {R package version `r packageVersion("INLAvaan")`},
    url = {https://inlavaan.haziqj.ml/},
    doi = {10.32614/CRAN.package.INLAvaan}
  }
```

## License

The `{INLAvaan}` package is licensed under the [GPL-3](https://www.gnu.org/licenses/gpl-3.0.en.html). 

```plaintext
INLAvaan: Bayesian Latent Variable Analysis using INLA
Copyright (C) 2026 Haziq Jamil

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
```

By using this package, you agree to comply with both licenses: 
the GPL-3 license for the software and the CC BY 4.0 license for the data.

